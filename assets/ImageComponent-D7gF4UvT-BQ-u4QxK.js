import{r as m,a as K,d as A,y as I,R as k,w as S,M,k as Y,D as B,F as U,z as V,N as q,C as G,K as E,b as J,c as O,e as Q,t as Z,i as o,f as _,o as ee,g as T}from"./index-BfnhXdAn.js";function X(h,y,l){return Math.min(Math.max(h,y),l)}const i={east:1,north:8,south:2,west:4};function te({onResizeStart:h,onResizeEnd:y,imageRef:l,maxWidth:R,editor:b}){const z=m.useRef(null),P=m.useRef({priority:"",value:"default"}),N=m.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),g=b.getRootElement(),v=R||(g!==null?g.getBoundingClientRect().width-20:100),C=g!==null?g.getBoundingClientRect().height-20:100,j=100,D=100,W=e=>{const s=e===i.east||e===i.west,r=e===i.north||e===i.south,w=e&i.north&&e&i.west||e&i.south&&e&i.east,d=s?"ew":r?"ns":w?"nwse":"nesw";g!==null&&g.style.setProperty("cursor",`${d}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${d}-resize`,"important"),P.current.value=document.body.style.getPropertyValue("-webkit-user-select"),P.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},u=()=>{g!==null&&g.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",P.current.value,P.current.priority))},f=(e,s)=>{if(!b.isEditable())return;const r=l.current,w=z.current;if(r!==null&&w!==null){e.preventDefault();const{width:d,height:p}=r.getBoundingClientRect(),a=T(r),t=N.current;t.startWidth=d,t.startHeight=p,t.ratio=d/p,t.currentWidth=d,t.currentHeight=p,t.startX=e.clientX/a,t.startY=e.clientY/a,t.isResizing=!0,t.direction=s,W(s),h(),w.classList.add("image-control-wrapper--resizing"),r.style.height=`${p}px`,r.style.width=`${d}px`,document.addEventListener("pointermove",$),document.addEventListener("pointerup",H)}},$=e=>{const s=l.current,r=N.current,w=r.direction&(i.east|i.west),d=r.direction&(i.south|i.north);if(s!==null&&r.isResizing){const p=T(s);if(w&&d){let a=Math.floor(r.startX-e.clientX/p);a=r.direction&i.east?-a:a;const t=X(r.startWidth+a,j,v),n=t/r.ratio;s.style.width=`${t}px`,s.style.height=`${n}px`,r.currentHeight=n,r.currentWidth=t}else if(d){let a=Math.floor(r.startY-e.clientY/p);a=r.direction&i.south?-a:a;const t=X(r.startHeight+a,D,C);s.style.height=`${t}px`,r.currentHeight=t}else{let a=Math.floor(r.startX-e.clientX/p);a=r.direction&i.east?-a:a;const t=X(r.startWidth+a,j,v);s.style.width=`${t}px`,r.currentWidth=t}}},H=()=>{const e=l.current,s=N.current,r=z.current;if(e!==null&&r!==null&&s.isResizing){const w=s.currentWidth,d=s.currentHeight;s.startWidth=0,s.startHeight=0,s.ratio=0,s.startX=0,s.startY=0,s.currentWidth=0,s.currentHeight=0,s.isResizing=!1,r.classList.remove("image-control-wrapper--resizing"),u(),y(w,d),document.removeEventListener("pointermove",$),document.removeEventListener("pointerup",H)}};return o.jsxs("div",{ref:z,children:[o.jsx("div",{className:"image-resizer image-resizer-n",onPointerDown:e=>{f(e,i.north)}}),o.jsx("div",{className:"image-resizer image-resizer-ne",onPointerDown:e=>{f(e,i.north|i.east)}}),o.jsx("div",{className:"image-resizer image-resizer-e",onPointerDown:e=>{f(e,i.east)}}),o.jsx("div",{className:"image-resizer image-resizer-se",onPointerDown:e=>{f(e,i.south|i.east)}}),o.jsx("div",{className:"image-resizer image-resizer-s",onPointerDown:e=>{f(e,i.south)}}),o.jsx("div",{className:"image-resizer image-resizer-sw",onPointerDown:e=>{f(e,i.south|i.west)}}),o.jsx("div",{className:"image-resizer image-resizer-w",onPointerDown:e=>{f(e,i.west)}}),o.jsx("div",{className:"image-resizer image-resizer-nw",onPointerDown:e=>{f(e,i.north|i.west)}})]})}const L=new Set,F="data:image/svg+xml;charset=UTF-8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22><rect width=%22200%22 height=%22200%22 fill=%22%23f0f0f0%22/><text x=%2250%25%22 y=%2250%25%22 alignment-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2216%22 fill=%22%23888%22>No Image</text></svg>";function re(h){if(!L.has(h))throw new Promise(y=>{const l=new Image;l.src=h,l.onload=()=>{L.add(h),y(null)},l.onerror=()=>{L.add(h)}})}function se({altText:h,className:y,imageRef:l,src:R,width:b,height:z}){return re(R||F),o.jsx("img",{className:y||void 0,src:R||F,alt:h,ref:l,style:{height:z,width:b,verticalAlign:"middle"},draggable:"false"})}function ne({src:h,altText:y,nodeKey:l,width:R,height:b,resizable:z,showCaption:P,captionsEnabled:N}){const g=m.useRef(null),[v,C,j]=K(l),[D,W]=m.useState(!1),[u]=A(),[f,$]=m.useState(null),H=m.useRef(null),e=I(),s=m.useCallback(t=>{const n=k();if(v&&S(n))t.preventDefault(),u.update(()=>{n.getNodes().forEach(c=>{M(c)&&c.remove()})});else if(Y(n)&&n.isCollapsed()){const c=n.anchor.getNode(),x=c.getPreviousSibling();if(B(x))return t.preventDefault(),c.remove(),x.select(),!0}return!1},[u,v]),r=m.useCallback(t=>{const n=k();if(Y(n)){const c=n.anchor.getNode();if(B(c)){U(null),t.preventDefault();const x=V();return n.anchor.offset===0?c.insertBefore(x):c.insertAfter(x),x.select(),!0}}return!1},[]),w=m.useCallback(t=>{const n=t;return D?!0:n.target===g.current?(n.shiftKey?C(!v):(j(),C(!0)),!0):!1},[D,v,C,j]);m.useEffect(()=>{let t=!0;const n=q(u.registerUpdateListener(({editorState:c})=>{t&&$(c.read(()=>k()))}),u.registerCommand(Z,(c,x)=>(H.current=x,!1),E),u.registerCommand(Q,w,E),u.registerCommand(O,s,E),u.registerCommand(J,s,E),u.registerCommand(G,r,E));return()=>{t=!1,n()}},[j,u,D,v,l,s,r,w,C]);const d=(t,n)=>{setTimeout(()=>{W(!1)},200),u.update(()=>{const c=_(l);M(c)&&c.setWidthAndHeight(t,n)}),u.dispatchCommand(ee,{width:t==="100%"?0:t,height:n==="100%"?0:n})},p=()=>{W(!0)},a=(v||D)&&e;return o.jsx(m.Suspense,{fallback:null,children:o.jsxs(o.Fragment,{children:[o.jsx("div",{children:o.jsx(se,{className:a?`focused ${S(f)?"draggable":""}`:null,src:h,altText:y,imageRef:g,width:R,height:b})}),z&&S(f)&&a&&o.jsx(te,{showCaption:P,editor:u,imageRef:g,onResizeStart:p,onResizeEnd:d,captionsEnabled:N})]})})}export{ne as default};
